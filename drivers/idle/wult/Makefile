# SPDX-License-Identifier: GPL-2.0-only
#
# Copyright (C) 2019-2021 Intel Corporation
# Authors: Artem Bityutskiy <artem.bityutskiy@linux.intel.com>

ifneq ($(KERNELRELEASE),)
# We've are part of the kernel build system.
wult-objs := main.o uapi.o tracer.o cstates.o
obj-m += wult.o
obj-m += wult_igb.o
obj-m += wult_tdt.o
obj-m += wult_hrt.o
else
# Out of tree build.

KVER := $(shell uname -r)
PWD := $(shell pwd)
KSRC := /lib/modules/${KVER}/source

default all modules:
	${MAKE} -C ${KSRC} M=${PWD} W=1 modules

install:
	${MAKE} -C ${KSRC} M=${PWD} W=1 modules_install

clean:
	${MAKE} -C ${KSRC} M=${PWD} clean

help:
	@echo "Targets:"
	@echo "  all   - Build the driver"
	@echo "  clean - Clean files generated by the build"
	@echo "Variables:"
	@echo "  KSRC  - Path to the kernel tree to build against"
	@echo
	@echo "You can also use any standard kernel variable like 'V=1'. Please, run "
	@echo "'make help' in kernel source tree form more information."
endif

list_deployables:
	@echo wult wult_igb wult_tdt wult_hrt
